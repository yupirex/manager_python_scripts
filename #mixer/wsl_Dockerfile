
# Указываем базовый образ для arm64 архитектуры. Важно явно указать --platform=linux/arm64, debian:bookworm - это стабильная и легкая база.
FROM --platform=linux/arm64 debian:bookworm

# Устанавливаем необходимые пакеты для сборки:
# python3, python3-pip - сам Python и pip для arm64
# build-essential - инструменты для компиляции (gcc и т.д.)
# git - если ваш проект использует git для зависимостей
# libffi-dev, libssl-dev, zlib1g-dev - часто необходимые библиотеки для Python-пакетов
# curl - для скачивания, если потребуется
RUN apt update \
  && apt install -y \
    python3 \
    python3-pip \
    python3-dev \
    python3-venv \
    build-essential \
    libffi-dev \
    libssl-dev \
    zlib1g-dev \
    git \
    curl \
    --no-install-recommends \
  && rm -rf /var/lib/apt/lists/*

# Создаем рабочую директорию в контейнере
WORKDIR /app

# Создаем виртуальное окружение. Это лучший способ изоляции зависимостей.
ENV VIRTUAL_ENV=/app/TEMP/.pyinstaller
ENV PATH="$VIRTUAL_ENV/bin:$PATH"

# Сначала обновляем pip, затем устанавливаем все пакеты, # Устанавливаем PyInstaller в то же виртуальное окружение
RUN python3 -m venv "$VIRTUAL_ENV" \
  && pip install --upgrade pip \
  && pip install pyinstaller

CMD ["/bin/sh"]
